!function(){function e(s,t,i){function o(n,c){if(!t[n]){if(!s[n]){var a="function"==typeof require&&require;if(!c&&a)return a(n,!0);if(r)return r(n,!0);var _=new Error("Cannot find module '"+n+"'");throw _.code="MODULE_NOT_FOUND",_}var l=t[n]={exports:{}};s[n][0].call(l.exports,function(e){return o(s[n][1][e]||e)},l,l.exports,e,s,t,i)}return t[n].exports}for(var r="function"==typeof require&&require,n=0;n<i.length;n++)o(i[n]);return o}return e}()({1:[function(e,s,t){var i,o,r=s.exports={};function n(){throw new Error("setTimeout has not been defined")}function c(){throw new Error("clearTimeout has not been defined")}!function(){try{i="function"==typeof setTimeout?setTimeout:n}catch(e){i=n}try{o="function"==typeof clearTimeout?clearTimeout:c}catch(e){o=c}}();function a(e){if(i===setTimeout)return setTimeout(e,0);if((i===n||!i)&&setTimeout)return i=setTimeout,setTimeout(e,0);try{return i(e,0)}catch(s){try{return i.call(null,e,0)}catch(s){return i.call(this,e,0)}}}var _,l=[],u=!1,h=-1;function p(){u&&_&&(u=!1,_.length?l=_.concat(l):h=-1,l.length&&d())}function d(){if(!u){var e=a(p);u=!0;for(var s=l.length;s;){for(_=l,l=[];++h<s;)_&&_[h].run();h=-1,s=l.length}_=null,u=!1,function(e){if(o===clearTimeout)return clearTimeout(e);if((o===c||!o)&&clearTimeout)return o=clearTimeout,clearTimeout(e);try{o(e)}catch(s){try{return o.call(null,e)}catch(s){return o.call(this,e)}}}(e)}}r.nextTick=function(e){var s=new Array(arguments.length-1);if(arguments.length>1)for(var t=1;t<arguments.length;t++)s[t-1]=arguments[t];l.push(new S(e,s)),1!==l.length||u||a(d)};function S(e,s){this.fun=e,this.array=s}S.prototype.run=function(){this.fun.apply(null,this.array)},r.title="browser",r.browser=!0,r.env={},r.argv=[],r.version="",r.versions={};function R(){}r.on=R,r.addListener=R,r.once=R,r.off=R,r.removeListener=R,r.removeAllListeners=R,r.emit=R,r.prependListener=R,r.prependOnceListener=R,r.listeners=function(e){return[]},r.binding=function(e){throw new Error("process.binding is not supported")},r.cwd=function(){return"/"},r.chdir=function(e){throw new Error("process.chdir is not supported")},r.umask=function(){return 0}},{}],2:[function(e,s,t){"use strict";var i=e("./wampy");window.Wampy=i.Wampy},{"./wampy":6}],3:[function(e,s,t){(function(e){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};t.WAMP_MSG_SPEC={HELLO:1,WELCOME:2,ABORT:3,CHALLENGE:4,AUTHENTICATE:5,GOODBYE:6,ERROR:8,PUBLISH:16,PUBLISHED:17,SUBSCRIBE:32,SUBSCRIBED:33,UNSUBSCRIBE:34,UNSUBSCRIBED:35,EVENT:36,CALL:48,CANCEL:49,RESULT:50,REGISTER:64,REGISTERED:65,UNREGISTER:66,UNREGISTERED:67,INVOCATION:68,INTERRUPT:69,YIELD:70},t.WAMP_ERROR_MSG={SUCCESS:{code:0,description:"Success!"},URI_ERROR:{code:1,description:"Topic URI doesn't meet requirements!"},NO_BROKER:{code:2,description:"Server doesn't provide broker role!"},NO_CALLBACK_SPEC:{code:3,description:"No required callback function specified!"},INVALID_PARAM:{code:4,description:"Invalid parameter(s) specified!"},NO_SERIALIZER_AVAILABLE:{code:6,description:"Server has chosen a serializer, which is not available!"},NON_EXIST_UNSUBSCRIBE:{code:7,description:"Trying to unsubscribe from non existent subscription!"},NO_DEALER:{code:12,description:"Server doesn't provide dealer role!"},RPC_ALREADY_REGISTERED:{code:15,description:"RPC already registered!"},NON_EXIST_RPC_UNREG:{code:17,description:"Received rpc unregistration for non existent rpc!"},NON_EXIST_RPC_INVOCATION:{code:19,description:"Received invocation for non existent rpc!"},NON_EXIST_RPC_REQ_ID:{code:20,description:"No RPC calls in action with specified request ID!"},NO_REALM:{code:21,description:"No realm specified!"},NO_WS_OR_URL:{code:22,description:"No websocket provided or URL specified is incorrect!"},NO_CRA_CB_OR_ID:{code:23,description:"No onChallenge callback or authid was provided for authentication!"},CRA_EXCEPTION:{code:24,description:"Exception raised during CRA challenge processing"}},t.ALLOWED_BINARY_TYPES=["blob","arraybuffer"],t.isNode="object"===(void 0===e?"undefined":s(e))&&"[object process]"===Object.prototype.toString.call(e)}).call(this,e("_process"))},{_process:1}],4:[function(e,s,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,s){for(var t=0;t<s.length;t++){var i=s[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(s,t,i){return t&&e(s.prototype,t),i&&e(s,i),s}}();t.JsonSerializer=function(){function e(){!function(e,s){if(!(e instanceof s))throw new TypeError("Cannot call a class as a function")}(this,e),this.protocol="json",this.isBinary=!0}return i(e,[{key:"encode",value:function(e){return JSON.stringify(e)}},{key:"decode",value:function(e){return new Promise(function(s){s(JSON.parse(e))})}}]),e}()},{}],5:[function(e,s,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getWebSocket=function(e,s,t,o,r){var n=i.isNode?(c=e,/^ws(s)?:\/\//.test(c)?c:null):function(e){var s=void 0,t=void 0;if(/^ws(s)?:\/\//.test(e))return e;return s="https:"===window.location.protocol?"wss://":"ws://",e?"/"===e[0]?(t=""!==window.location.port?":"+window.location.port:"",s+window.location.hostname+t+e):s+e:(t=""!==window.location.port?":"+window.location.port:"",s+window.location.hostname+t+"/ws")}(e);var c;if(!n)return null;{if(t)return new t(n,s,null,o,r);if(i.isNode)return null;if("WebSocket"in window)return new window.WebSocket(n,s);if("MozWebSocket"in window)return new window.MozWebSocket(n,s)}return null};var i=e("./constants")},{"./constants":3}],6:[function(e,s,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Wampy=void 0;var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=function(){function e(e,s){for(var t=0;t<s.length;t++){var i=s[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(s,t,i){return t&&e(s.prototype,t),i&&e(s,i),s}}(),r=e("./constants"),n=e("./utils"),c=e("./serializers/JsonSerializer");var a=function(){function e(s,t){!function(e,s){if(!(e instanceof s))throw new TypeError("Cannot call a class as a function")}(this,e),this.version="v6.2.0",this._url="string"==typeof s?s:null,this._protocols=["wamp.2.json"],this._wamp_features={agent:"Wampy.js "+this.version,roles:{publisher:{features:{subscriber_blackwhite_listing:!0,publisher_exclusion:!0,publisher_identification:!0}},subscriber:{features:{pattern_based_subscription:!0,publication_trustlevels:!0}},caller:{features:{caller_identification:!0,progressive_call_results:!0,call_canceling:!0,call_timeout:!0}},callee:{features:{caller_identification:!0,call_trustlevels:!0,pattern_based_registration:!0,shared_registration:!0}}}},this._cache={sessionId:null,reqId:0,server_wamp_features:{roles:{}},isSayingGoodbye:!1,opStatus:{code:0,description:"Success!",reqId:0},timer:null,reconnectingAttempts:0},this._ws=null,this._wsQueue=[],this._requests={},this._calls={},this._subscriptions={},this._subsTopics=new Set,this._rpcRegs={},this._rpcNames=new Set,this._options={debug:!1,autoReconnect:!0,reconnectInterval:2e3,maxRetries:25,realm:null,helloCustomDetails:null,authid:null,authmethods:[],onChallenge:null,onConnect:null,onClose:null,onError:null,onReconnect:null,onReconnectSuccess:null,ws:null,additionalHeaders:null,wsRequestOptions:null,serializer:new c.JsonSerializer},this._isPlainObject(t)?this._options=this._merge(this._options,t):this._isPlainObject(s)&&(this._options=this._merge(this._options,s)),this._url&&this.connect()}return o(e,[{key:"_log",value:function(){if(this._options.debug)for(var e=arguments.length,s=Array(e),t=0;t<e;t++)s[t]=arguments[t]}},{key:"_getReqId",value:function(){return++this._cache.reqId}},{key:"_merge",value:function(){for(var e=arguments.length,s=Array(e),t=0;t<e;t++)s[t]=arguments[t];var i={},o=s.length,r=void 0,n=void 0;for(r=0;r<o;r++)for(n in s[r])i[n]=s[r][n];return i}},{key:"_isArray",value:function(e){return!!e&&Array.isArray(e)}},{key:"_isPlainObject",value:function(e){return!!e&&e.constructor===Object}},{key:"_setWsProtocols",value:function(){this._options.serializer instanceof c.JsonSerializer||this._protocols.unshift("wamp.2."+this._options.serializer.protocol)}},{key:"_preReqChecks",value:function(e,s,t){var i=!0;return this._cache.sessionId&&!this._cache.server_wamp_features.roles[s]&&(this._cache.opStatus=r.WAMP_ERROR_MSG["NO_"+s.toUpperCase()],i=!1),e&&!this._validateURI(e.topic,e.patternBased,e.allowWAMP)&&(this._cache.opStatus=r.WAMP_ERROR_MSG.URI_ERROR,i=!1),!!i||(this._isPlainObject(t)&&t.onError&&t.onError({error:this._cache.opStatus.description}),!1)}},{key:"_validateURI",value:function(e,s,t){var i=s?/^([0-9a-zA-Z_]+\.{1,2})*([0-9a-zA-Z_]+)$/:/^([0-9a-zA-Z_]+\.)*([0-9a-zA-Z_]+)$/;return t?i.test(e):!(!i.test(e)||0===e.indexOf("wamp."))}},{key:"_encode",value:function(e){try{return this._options.serializer.encode(e)}catch(e){this._hardClose("wamp.error.protocol_violation","Can not encode message")}}},{key:"_decode",value:function(e){return this._options.serializer.decode(e)}},{key:"_hardClose",value:function(e,s){this._log("[wampy] "+s),this._wsQueue=[],this._send([r.WAMP_MSG_SPEC.ABORT,{message:s},e]),this._options.onError&&this._options.onError({error:e,details:s}),this._ws.close()}},{key:"_send",value:function(e){if(e&&this._wsQueue.push(this._encode(e)),this._ws&&1===this._ws.readyState&&this._cache.sessionId)for(;this._wsQueue.length;)this._ws.send(this._wsQueue.shift())}},{key:"_resetState",value:function(){this._wsQueue=[],this._subscriptions={},this._subsTopics=new Set,this._requests={},this._calls={},this._rpcRegs={},this._rpcNames=new Set,this._cache={reqId:0,reconnectingAttempts:0}}},{key:"_initWsCallbacks",value:function(){var e=this;this._ws&&(this._ws.onopen=function(){e._wsOnOpen()},this._ws.onclose=function(s){e._wsOnClose(s)},this._ws.onmessage=function(s){e._wsOnMessage(s)},this._ws.onerror=function(s){e._wsOnError(s)})}},{key:"_wsOnOpen",value:function(){var e=this._merge(this._options.helloCustomDetails,this._wamp_features),s=this._ws.protocol?this._ws.protocol.split(".")[2]:"";if(this._options.authid&&(e.authmethods=this._options.authmethods,e.authid=this._options.authid),this._log("[wampy] websocket connected"),this._options.serializer.protocol!==s){if("json"!==s)return this._cache.opStatus=r.WAMP_ERROR_MSG.NO_SERIALIZER_AVAILABLE,this;this._options.serializer=new c.JsonSerializer}this._options.serializer.isBinary&&(this._ws.binaryType="arraybuffer"),this._ws.send(this._encode([r.WAMP_MSG_SPEC.HELLO,this._options.realm,e]))}},{key:"_wsOnClose",value:function(e){var s=this;this._log("[wampy] websocket disconnected. Info: ",e),(this._cache.sessionId||this._cache.reconnectingAttempts)&&this._options.autoReconnect&&this._cache.reconnectingAttempts<this._options.maxRetries&&!this._cache.isSayingGoodbye?(this._cache.sessionId=null,this._cache.timer=setTimeout(function(){s._wsReconnect()},this._options.reconnectInterval)):(this._options.onClose&&this._options.onClose(),this._resetState(),this._ws=null)}},{key:"_wsOnMessage",value:function(e){var s=this;this._decode(e.data).then(function(e){s._log("[wampy] websocket message received: ",e);var t=void 0,i=void 0,o=s;switch(e[0]){case r.WAMP_MSG_SPEC.WELCOME:s._cache.sessionId?s._hardClose("wamp.error.protocol_violation","Received WELCOME message after session was established"):(s._cache.sessionId=e[1],s._cache.server_wamp_features=e[2],s._cache.reconnectingAttempts?(s._cache.reconnectingAttempts=0,s._options.onReconnectSuccess&&s._options.onReconnectSuccess(),s._renewSubscriptions(),s._renewRegistrations()):s._options.onConnect&&s._options.onConnect(),s._send());break;case r.WAMP_MSG_SPEC.ABORT:s._options.onError&&s._options.onError({error:e[2],details:e[1]}),s._ws.close();break;case r.WAMP_MSG_SPEC.CHALLENGE:s._cache.sessionId?s._hardClose("wamp.error.protocol_violation","Received CHALLENGE message after session was established"):s._options.authid&&"function"==typeof s._options.onChallenge?new Promise(function(t,i){t(s._options.onChallenge(e[1],e[2]))}).then(function(e){s._ws.send(s._encode([r.WAMP_MSG_SPEC.AUTHENTICATE,e,{}]))}).catch(function(e){s._ws.send(s._encode([r.WAMP_MSG_SPEC.ABORT,{message:"Exception in onChallenge handler raised!"},"wamp.error.cannot_authenticate"])),s._options.onError&&s._options.onError({error:r.WAMP_ERROR_MSG.CRA_EXCEPTION.description}),s._ws.close(),s._cache.opStatus=r.WAMP_ERROR_MSG.CRA_EXCEPTION}):(s._ws.send(s._encode([r.WAMP_MSG_SPEC.ABORT,{message:r.WAMP_ERROR_MSG.NO_CRA_CB_OR_ID.description},"wamp.error.cannot_authenticate"])),s._options.onError&&s._options.onError({error:r.WAMP_ERROR_MSG.NO_CRA_CB_OR_ID.description}),s._ws.close(),s._cache.opStatus=r.WAMP_ERROR_MSG.NO_CRA_CB_OR_ID);break;case r.WAMP_MSG_SPEC.GOODBYE:s._cache.sessionId?(s._cache.isSayingGoodbye||(s._cache.isSayingGoodbye=!0,s._send([r.WAMP_MSG_SPEC.GOODBYE,{},"wamp.close.goodbye_and_out"])),s._cache.sessionId=null,s._ws.close()):s._hardClose("wamp.error.protocol_violation","Received GOODBYE message before session was established");break;case r.WAMP_MSG_SPEC.ERROR:if(s._cache.sessionId)switch(e[1]){case r.WAMP_MSG_SPEC.SUBSCRIBE:case r.WAMP_MSG_SPEC.UNSUBSCRIBE:case r.WAMP_MSG_SPEC.PUBLISH:case r.WAMP_MSG_SPEC.REGISTER:case r.WAMP_MSG_SPEC.UNREGISTER:s._requests[e[2]]&&s._requests[e[2]].callbacks.onError&&s._requests[e[2]].callbacks.onError({error:e[4],details:e[3],argsList:e[5],argsDict:e[6]}),delete s._requests[e[2]];break;case r.WAMP_MSG_SPEC.CALL:s._calls[e[2]]&&s._calls[e[2]].onError&&s._calls[e[2]].onError({error:e[4],details:e[3],argsList:e[5],argsDict:e[6]}),delete s._calls[e[2]];break;default:s._hardClose("wamp.error.protocol_violation","Received invalid ERROR message")}else s._hardClose("wamp.error.protocol_violation","Received ERROR message before session was established");break;case r.WAMP_MSG_SPEC.SUBSCRIBED:s._cache.sessionId?s._requests[e[1]]&&(s._subscriptions[s._requests[e[1]].topic]=s._subscriptions[e[2]]={id:e[2],callbacks:[s._requests[e[1]].callbacks.onEvent]},s._subsTopics.add(s._requests[e[1]].topic),s._requests[e[1]].callbacks.onSuccess&&s._requests[e[1]].callbacks.onSuccess(),delete s._requests[e[1]]):s._hardClose("wamp.error.protocol_violation","Received SUBSCRIBED message before session was established");break;case r.WAMP_MSG_SPEC.UNSUBSCRIBED:s._cache.sessionId?s._requests[e[1]]&&(t=s._subscriptions[s._requests[e[1]].topic].id,delete s._subscriptions[s._requests[e[1]].topic],delete s._subscriptions[t],s._subsTopics.has(s._requests[e[1]].topic)&&s._subsTopics.delete(s._requests[e[1]].topic),s._requests[e[1]].callbacks.onSuccess&&s._requests[e[1]].callbacks.onSuccess(),delete s._requests[e[1]]):s._hardClose("wamp.error.protocol_violation","Received UNSUBSCRIBED message before session was established");break;case r.WAMP_MSG_SPEC.PUBLISHED:s._cache.sessionId?s._requests[e[1]]&&(s._requests[e[1]].callbacks&&s._requests[e[1]].callbacks.onSuccess&&s._requests[e[1]].callbacks.onSuccess(),delete s._requests[e[1]]):s._hardClose("wamp.error.protocol_violation","Received PUBLISHED message before session was established");break;case r.WAMP_MSG_SPEC.EVENT:if(s._cache.sessionId){if(s._subscriptions[e[1]])for(i=s._subscriptions[e[1]].callbacks.length;i--;)s._subscriptions[e[1]].callbacks[i]({details:e[3],argsList:e[4],argsDict:e[5]})}else s._hardClose("wamp.error.protocol_violation","Received EVENT message before session was established");break;case r.WAMP_MSG_SPEC.RESULT:s._cache.sessionId?s._calls[e[1]]&&(s._calls[e[1]].onSuccess({details:e[2],argsList:e[3],argsDict:e[4]}),e[2].progress&&!0===e[2].progress||delete s._calls[e[1]]):s._hardClose("wamp.error.protocol_violation","Received RESULT message before session was established");break;case r.WAMP_MSG_SPEC.REGISTERED:s._cache.sessionId?s._requests[e[1]]&&(s._rpcRegs[s._requests[e[1]].topic]=s._rpcRegs[e[2]]={id:e[2],callbacks:[s._requests[e[1]].callbacks.rpc]},s._rpcNames.add(s._requests[e[1]].topic),s._requests[e[1]].callbacks&&s._requests[e[1]].callbacks.onSuccess&&s._requests[e[1]].callbacks.onSuccess(),delete s._requests[e[1]]):s._hardClose("wamp.error.protocol_violation","Received REGISTERED message before session was established");break;case r.WAMP_MSG_SPEC.UNREGISTERED:s._cache.sessionId?s._requests[e[1]]&&(t=s._rpcRegs[s._requests[e[1]].topic].id,delete s._rpcRegs[s._requests[e[1]].topic],delete s._rpcRegs[t],s._rpcNames.has(s._requests[e[1]].topic)&&s._rpcNames.delete(s._requests[e[1]].topic),s._requests[e[1]].callbacks&&s._requests[e[1]].callbacks.onSuccess&&s._requests[e[1]].callbacks.onSuccess(),delete s._requests[e[1]]):s._hardClose("wamp.error.protocol_violation","Received UNREGISTERED message before session was established");break;case r.WAMP_MSG_SPEC.INVOCATION:if(s._cache.sessionId)if(s._rpcRegs[e[2]]){var n=function(s){var t=[r.WAMP_MSG_SPEC.YIELD,e[1],{}];o._isPlainObject(s)?(o._isPlainObject(s.options)&&(t[2]=s.options),o._isArray(s.argsList)?t.push(s.argsList):void 0!==s.argsList&&t.push([s.argsList]),o._isPlainObject(s.argsDict)&&(3===t.length&&t.push([]),t.push(s.argsDict))):t=[r.WAMP_MSG_SPEC.YIELD,e[1],{}],o._send(t)},c=function(s){var t=s.details,i=s.error,n=s.argsList,c=s.argsDict,a=[r.WAMP_MSG_SPEC.ERROR,r.WAMP_MSG_SPEC.INVOCATION,e[1],t||{},i||"wamp.error.invocation_exception"];n&&o._isArray(n)&&a.push(n),c&&o._isPlainObject(c)&&(5===a.length&&a.push([]),a.push(c)),o._send(a)};new Promise(function(t,i){t(s._rpcRegs[e[2]].callbacks[0]({details:e[3],argsList:e[4],argsDict:e[5],result_handler:n,error_handler:c}))}).then(function(e){n(e)}).catch(function(e){c(e)})}else s._send([r.WAMP_MSG_SPEC.ERROR,r.WAMP_MSG_SPEC.INVOCATION,e[1],{},"wamp.error.no_such_procedure"]),s._cache.opStatus=r.WAMP_ERROR_MSG.NON_EXIST_RPC_INVOCATION;else s._hardClose("wamp.error.protocol_violation","Received INVOCATION message before session was established");break;default:s._hardClose("wamp.error.protocol_violation","Received non-compliant WAMP message")}},function(e){s._hardClose("wamp.error.protocol_violation","Can not decode received message")})}},{key:"_wsOnError",value:function(e){this._log("[wampy] websocket error"),this._options.onError&&this._options.onError({error:e})}},{key:"_wsReconnect",value:function(){this._log("[wampy] websocket reconnecting..."),this._options.onReconnect&&this._options.onReconnect(),this._cache.reconnectingAttempts++,this._ws=(0,n.getWebSocket)(this._url,this._protocols,this._options.ws,this._options.additionalHeaders,this._options.wsRequestOptions),this._initWsCallbacks()}},{key:"_renewSubscriptions",value:function(){var e=void 0,s=this._subscriptions,t=this._subsTopics;this._subscriptions={},this._subsTopics=new Set;var i=!0,o=!1,r=void 0;try{for(var n,c=t[Symbol.iterator]();!(i=(n=c.next()).done);i=!0){var a=n.value;for(e=s[a].callbacks.length;e--;)this.subscribe(a,s[a].callbacks[e])}}catch(e){o=!0,r=e}finally{try{!i&&c.return&&c.return()}finally{if(o)throw r}}}},{key:"_renewRegistrations",value:function(){var e=this._rpcRegs,s=this._rpcNames;this._rpcRegs={},this._rpcNames=new Set;var t=!0,i=!1,o=void 0;try{for(var r,n=s[Symbol.iterator]();!(t=(r=n.next()).done);t=!0){var c=r.value;this.register(c,{rpc:e[c].callbacks[0]})}}catch(e){i=!0,o=e}finally{try{!t&&n.return&&n.return()}finally{if(i)throw o}}}},{key:"options",value:function(e){return void 0===e?this._options:this._isPlainObject(e)?(this._options=this._merge(this._options,e),this):void 0}},{key:"getOpStatus",value:function(){return this._cache.opStatus}},{key:"getSessionId",value:function(){return this._cache.sessionId}},{key:"connect",value:function(e){if(e&&(this._url=e),this._options.realm){var s=(this._options.authid?1:0)+(this._isArray(this._options.authmethods)&&this._options.authmethods.length?1:0)+("function"==typeof this._options.onChallenge?1:0);if(s>0&&s<3)return this._cache.opStatus=r.WAMP_ERROR_MSG.NO_CRA_CB_OR_ID,this;if(this._setWsProtocols(),this._ws=(0,n.getWebSocket)(this._url,this._protocols,this._options.ws,this._options.additionalHeaders,this._options.wsRequestOptions),!this._ws)return this._cache.opStatus=r.WAMP_ERROR_MSG.NO_WS_OR_URL,this;this._initWsCallbacks()}else this._cache.opStatus=r.WAMP_ERROR_MSG.NO_REALM;return this}},{key:"disconnect",value:function(){return this._cache.sessionId?(this._cache.isSayingGoodbye=!0,this._send([r.WAMP_MSG_SPEC.GOODBYE,{},"wamp.close.system_shutdown"])):this._ws&&this._ws.close(),this._cache.opStatus=r.WAMP_ERROR_MSG.SUCCESS,this}},{key:"abort",value:function(){return this._cache.sessionId||1!==this._ws.readyState||(this._send([r.WAMP_MSG_SPEC.ABORT,{},"wamp.error.abort"]),this._cache.sessionId=null),this._ws.close(),this._cache.opStatus=r.WAMP_ERROR_MSG.SUCCESS,this}},{key:"subscribe",value:function(e,s,t){var i=void 0,o=!1,n={};if(void 0!==t&&this._isPlainObject(t)&&t.hasOwnProperty("match")&&/prefix|wildcard/.test(t.match)&&(n.match=t.match,o=!0),!this._preReqChecks({topic:e,patternBased:o,allowWAMP:!0},"broker",s))return this;if("function"==typeof s)s={onEvent:s};else if(!this._isPlainObject(s)||void 0===s.onEvent)return this._cache.opStatus=r.WAMP_ERROR_MSG.NO_CALLBACK_SPEC,this._isPlainObject(s)&&s.onError&&s.onError({error:this._cache.opStatus.description}),this;return this._subscriptions[e]&&this._subscriptions[e].callbacks.length?(this._subscriptions[e].callbacks.indexOf(s.onEvent)<0&&this._subscriptions[e].callbacks.push(s.onEvent),s.onSuccess&&s.onSuccess()):(i=this._getReqId(),this._requests[i]={topic:e,callbacks:s},this._send([r.WAMP_MSG_SPEC.SUBSCRIBE,i,n,e])),this._cache.opStatus=r.WAMP_ERROR_MSG.SUCCESS,this._cache.opStatus.reqId=i,this}},{key:"unsubscribe",value:function(e,s){var t=void 0,i=-1;return this._preReqChecks(null,"broker",s)?this._subscriptions[e]?(t=this._getReqId(),void 0===s?(this._subscriptions[e].callbacks=[],s={}):"function"==typeof s?(i=this._subscriptions[e].callbacks.indexOf(s),s={}):s.onEvent&&"function"==typeof s.onEvent?i=this._subscriptions[e].callbacks.indexOf(s.onEvent):this._subscriptions[e].callbacks=[],i>=0&&this._subscriptions[e].callbacks.splice(i,1),this._subscriptions[e].callbacks.length?(this._cache.opStatus=r.WAMP_ERROR_MSG.SUCCESS,this):(this._requests[t]={topic:e,callbacks:s},this._send([r.WAMP_MSG_SPEC.UNSUBSCRIBE,t,this._subscriptions[e].id]),this._cache.opStatus=r.WAMP_ERROR_MSG.SUCCESS,this._cache.opStatus.reqId=t,this)):(this._cache.opStatus=r.WAMP_ERROR_MSG.NON_EXIST_UNSUBSCRIBE,this._isPlainObject(s)&&s.onError&&s.onError({error:this._cache.opStatus.description}),this):this}},{key:"publish",value:function(e,s,t,o){var n=this,c=void 0,a=void 0,_=!1,l=!1,u={},h=function(e,s){o[e]&&(n._isArray(o[e])&&o[e].length?u[e]=o[e]:i(o[e])===s?u[e]=[o[e]]:_=!0)};if(!this._preReqChecks({topic:e,patternBased:!1,allowWAMP:!1},"broker",t))return this;if(this._isPlainObject(t)&&(u.acknowledge=!0),void 0!==o&&(this._isPlainObject(o)?(h("exclude","number"),h("exclude_authid","string"),h("exclude_authrole","string"),h("eligible","number"),h("eligible_authid","string"),h("eligible_authrole","string"),o.hasOwnProperty("exclude_me")&&(u.exclude_me=!1!==o.exclude_me),o.hasOwnProperty("disclose_me")&&(u.disclose_me=!0===o.disclose_me)):_=!0,_))return this._cache.opStatus=r.WAMP_ERROR_MSG.INVALID_PARAM,this._isPlainObject(t)&&t.onError&&t.onError({error:this._cache.opStatus.description}),this;switch(c=this._getReqId(),arguments.length){case 1:break;case 2:l=!0;break;default:this._requests[c]={topic:e,callbacks:t},l=!0}return a=[r.WAMP_MSG_SPEC.PUBLISH,c,u,e],l&&(this._isArray(s)?a.push(s):this._isPlainObject(s)?s.argsList||s.argsDict?(s.argsList&&a.push(s.argsList),s.argsDict&&(4===a.length&&a.push([]),a.push(s.argsDict))):a.push([],s):a.push([s])),this._send(a),this._cache.opStatus=r.WAMP_ERROR_MSG.SUCCESS,this._cache.opStatus.reqId=c,this}},{key:"call",value:function(e,s,t,i){var o=void 0,n=void 0,c=!1,a={};if(!this._preReqChecks({topic:e,patternBased:!1,allowWAMP:!0},"dealer",t))return this;if("function"==typeof t)t={onSuccess:t};else if(!this._isPlainObject(t)||void 0===t.onSuccess)return this._cache.opStatus=r.WAMP_ERROR_MSG.NO_CALLBACK_SPEC,this._isPlainObject(t)&&t.onError&&t.onError({error:this._cache.opStatus.description}),this;if(void 0!==i&&(this._isPlainObject(i)?(i.hasOwnProperty("disclose_me")&&(a.disclose_me=!0===i.disclose_me),i.hasOwnProperty("receive_progress")&&(a.receive_progress=!0===i.receive_progress),i.hasOwnProperty("timeout")&&("number"==typeof i.timeout?a.timeout=i.timeout:c=!0)):c=!0,c))return this._cache.opStatus=r.WAMP_ERROR_MSG.INVALID_PARAM,this._isPlainObject(t)&&t.onError&&t.onError({error:this._cache.opStatus.description}),this;do{o=this._getReqId()}while(o in this._calls);return this._calls[o]=t,n=[r.WAMP_MSG_SPEC.CALL,o,a,e],null!==s&&(this._isArray(s)?n.push(s):this._isPlainObject(s)?s.argsList||s.argsDict?(s.argsList&&n.push(s.argsList),s.argsDict&&(4===n.length&&n.push([]),n.push(s.argsDict))):n.push([],s):n.push([s])),this._send(n),this._cache.opStatus=r.WAMP_ERROR_MSG.SUCCESS,this._cache.opStatus.reqId=o,this}},{key:"cancel",value:function(e,s,t){var i=!1,o={};return this._preReqChecks(null,"dealer",s)?e&&this._calls[e]?void 0!==t&&(this._isPlainObject(t)?t.hasOwnProperty("mode")&&(/skip|kill|killnowait/.test(t.mode)?o.mode=t.mode:i=!0):i=!0,i)?(this._cache.opStatus=r.WAMP_ERROR_MSG.INVALID_PARAM,this._isPlainObject(s)&&s.onError&&s.onError({error:this._cache.opStatus.description}),this):(this._send([r.WAMP_MSG_SPEC.CANCEL,e,o]),this._cache.opStatus=r.WAMP_ERROR_MSG.SUCCESS,this._cache.opStatus.reqId=e,s.onSuccess&&s.onSuccess(),this):(this._cache.opStatus=r.WAMP_ERROR_MSG.NON_EXIST_RPC_REQ_ID,this._isPlainObject(s)&&s.onError&&s.onError({error:this._cache.opStatus.description}),this):this}},{key:"register",value:function(e,s,t){var i=void 0,o=!1,n=!1,c={};if(void 0!==t&&(this._isPlainObject(t)?(t.hasOwnProperty("match")&&(/prefix|wildcard/.test(t.match)?(c.match=t.match,o=!0):n=!0),t.hasOwnProperty("invoke")&&(/single|roundrobin|random|first|last/.test(t.invoke)?c.invoke=t.invoke:n=!0)):n=!0,n))return this._cache.opStatus=r.WAMP_ERROR_MSG.INVALID_PARAM,this._isPlainObject(s)&&s.onError&&s.onError({error:this._cache.opStatus.description}),this;if(!this._preReqChecks({topic:e,patternBased:o,allowWAMP:!1},"dealer",s))return this;if("function"==typeof s)s={rpc:s};else if(!this._isPlainObject(s)||void 0===s.rpc)return this._cache.opStatus=r.WAMP_ERROR_MSG.NO_CALLBACK_SPEC,this._isPlainObject(s)&&s.onError&&s.onError({error:this._cache.opStatus.description}),this;return this._rpcRegs[e]&&this._rpcRegs[e].callbacks.length?(this._cache.opStatus=r.WAMP_ERROR_MSG.RPC_ALREADY_REGISTERED,this._isPlainObject(s)&&s.onError&&s.onError({error:this._cache.opStatus.description})):(i=this._getReqId(),this._requests[i]={topic:e,callbacks:s},this._send([r.WAMP_MSG_SPEC.REGISTER,i,c,e]),this._cache.opStatus=r.WAMP_ERROR_MSG.SUCCESS,this._cache.opStatus.reqId=i),this}},{key:"unregister",value:function(e,s){var t=void 0;return this._preReqChecks({topic:e,patternBased:!1,allowWAMP:!1},"dealer",s)?("function"==typeof s&&(s={onSuccess:s}),this._rpcRegs[e]?(t=this._getReqId(),this._requests[t]={topic:e,callbacks:s},this._send([r.WAMP_MSG_SPEC.UNREGISTER,t,this._rpcRegs[e].id]),this._cache.opStatus=r.WAMP_ERROR_MSG.SUCCESS,this._cache.opStatus.reqId=t):(this._cache.opStatus=r.WAMP_ERROR_MSG.NON_EXIST_RPC_UNREG,this._isPlainObject(s)&&s.onError&&s.onError({error:this._cache.opStatus.description})),this):this}}]),e}();t.default=a,t.Wampy=a},{"./constants":3,"./serializers/JsonSerializer":4,"./utils":5}]},{},[2]);
//# sourceMappingURL=wampy.min.js.map